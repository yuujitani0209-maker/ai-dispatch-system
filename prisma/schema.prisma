datasource db {
  provider = "sqlite"
  url      = "file:./dispatch.db"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  role      String
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  drivers    Driver[]
  trucks     Truck[]
  dispatches Dispatch[]
  logs       Log[]
}

model Driver {
  id            Int      @id @default(autoincrement())
  user          User     @relation(fields: [userId], references: [id])
  userId        Int
  licenseNumber String
  dispatches    Dispatch[]
}

model Truck {
  id         Int      @id @default(autoincrement())
  user       User     @relation(fields: [userId], references: [id])
  userId     Int
  plate      String
  capacity   Float
  dispatches Dispatch[]
}

model Cargo {
  id             Int      @id @default(autoincrement())
  weight         Float
  pickupLocation String
  dropoffLocation String
  pickupDate     DateTime?
  dropoffDate    DateTime?
  dispatch       Dispatch? @relation(fields: [dispatchId], references: [id])
  dispatchId     Int?
}

model Dispatch {
  id          Int      @id @default(autoincrement())
  description String
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])
  userId      Int
  driver      Driver?  @relation(fields: [driverId], references: [id])
  driverId    Int?
  truck       Truck?   @relation(fields: [truckId], references: [id])
  truckId     Int?
  cargos      Cargo[]
  invoices    Invoice[]
  logs        Log[]
}

model Log {
  id         Int      @id @default(autoincrement())
  message    String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
  userId     Int
  dispatch   Dispatch? @relation(fields: [dispatchId], references: [id])
  dispatchId Int?
}

model Invoice {
  id         Int      @id @default(autoincrement())
  dispatch   Dispatch @relation(fields: [dispatchId], references: [id])
  dispatchId Int
  amount     Float
  issuedAt   DateTime @default(now())
}
